{% extends "base.html" %}
{% block title %}공지 수정 - {{ notice.title }}{% endblock %}

{% block content %}
<div class="notice-page-wrapper">
    <h1 class="page-title">공지 수정</h1>

    <div class="card" style="width:100%; max-width:900px;">
        <form method="POST" enctype="multipart/form-data" id="noticeEditForm">
            <label>분류</label>
            <select name="category" required>
                <option value="일반공지" {% if notice.category == "일반공지" %}selected{% endif %}>일반공지</option>
                <option value="방송공지" {% if notice.category == "방송공지" %}selected{% endif %}>방송공지</option>
                <option value="패치노트" {% if notice.category == "패치노트" %}selected{% endif %}>패치노트</option>
            </select>

            <label>제목</label>
            <input type="text" name="title" value="{{ notice.title }}" required>

            <label>내용</label>
            <div id="editor">{{ notice.content|safe }}</div>
            <input type="hidden" name="content_html" id="content_html">

            <label>이미지 첨부 (선택, 새로 업로드 시 변경)</label>
            <input type="file" name="image" accept="image/*">

            <div style="margin-top:12px; display:flex; gap:8px;">
                <button type="submit" name="action" value="draft" class="btn" style="background:#9e9e9e;">임시저장</button>
                <button type="submit" name="action" value="publish" class="btn">수정 완료</button>
            </div>
        </form>
    </div>
</div>

<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>

<script>
  var Font = Quill.import('formats/font');
  Font.whitelist = ['sans', 'gowun', 'diphylleia'];
  Quill.register(Font, true);

  const toolbarOptions = [
    [{ 'font': Font.whitelist }],
    [{ 'size': ['small', false, 'large', 'huge'] }],
    ['bold', 'italic', 'underline', 'strike'],
    [{ 'color': [] }, { 'background': [] }],
    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
    [{ 'align': [] }],
    ['link'],
    ['clean']
  ];

  var quill = new Quill('#editor', {
    theme: 'snow',
    modules: { toolbar: toolbarOptions }
  });

  document.getElementById('noticeEditForm').addEventListener('submit', function () {
    document.getElementById('content_html').value = quill.root.innerHTML;
  });
</script>
{% endblock %}
