<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ShowkerTMS{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<audio id="bgMusic" autoplay loop>
    <source src="{{ url_for('static', filename='assets/mainmusic.mp3') }}" type="audio/mpeg">
</audio>

<div class="sakura-container" id="sakuraContainer"></div>

<nav>
    <a href="{{ url_for('index') }}">소개</a>
    <a href="{{ url_for('link_page') }}">링크</a>
    <a href="{{ url_for('notice_list') }}">공지글</a>
    <a href="{{ url_for('business_page') }}">비즈니스</a>
    <a href="{{ url_for('contact_page') }}">문의</a>
    <a href="{{ url_for('qna_list') }}">Q&A</a>
    <a href="{{ url_for('stream_page') }}">방송 정보</a>

    {% if current_user.is_authenticated %}
        <a href="{{ url_for('profile') }}">프로필</a>
        {% if has_permission(current_user, 'warning_manage') or has_permission(current_user, 'promote') %}
            <a href="{{ url_for('dashboard') }}">대시보드</a>
        {% endif %}
        <a href="{{ url_for('logout') }}">로그아웃</a>
    {% else %}
        <a href="{{ url_for('login') }}">로그인</a>
        <a href="{{ url_for('register') }}">회원가입</a>
    {% endif %}
</nav>

{# ▶ 네비게이션 바로 아래 방송 상태 줄 #}
<div class="stream-status-bar"
     style="margin:4px auto 0; max-width:1200px; text-align:center; font-size:12px;">
    {% if current_stream %}
        {% if current_stream.status == "방송중" and current_stream.platform %}
            {% if current_stream.url %}
                <a href="{{ current_stream.url }}" target="_blank"
                   class="stream-status-live"
                   style="color:#e53935; font-weight:bold; text-decoration:none;">
                    ● LIVE ({{ current_stream.platform }})
                </a>
            {% else %}
                <span class="stream-status-live"
                      style="color:#e53935; font-weight:bold;">
                    ● LIVE ({{ current_stream.platform }})
                </span>
            {% endif %}
        {% else %}
            <span class="stream-status-text" style="color:#eeeeee;">
                상태: {{ current_stream.status }}
            </span>
        {% endif %}
    {% else %}
        <span class="stream-status-text" style="color:#eeeeee;">
            상태: 오프라인
        </span>
    {% endif %}
</div>

<main>
    <div class="page-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, msg in messages %}
                <div class="flash flash-{{ category }}">{{ msg }}</div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>
</main>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
