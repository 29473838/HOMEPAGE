{% extends "base.html" %}
{% block title %}공지 작성 - 소리가 담긴 타임머신{% endblock %}

{% block content %}
<div class="notice-page-wrapper">
    <h1 class="page-title">새 공지 작성</h1>

    <div class="card" style="width:100%; max-width:900px;">
        <form method="POST" enctype="multipart/form-data" id="noticeForm">
            <label>분류</label>
            <select name="category" required>
                <option value="일반공지">일반공지</option>
                <option value="방송공지">방송공지</option>
                <option value="패치노트">패치노트</option>
            </select>

            <label>제목</label>
            <input type="text" name="title" placeholder="제목" required>

            <label>내용</label>
            <div id="editor"></div>
            <input type="hidden" name="content_html" id="content_html">

            <label>이미지 첨부 (선택)</label>
            <input type="file" name="image" accept="image/*">

            <div style="margin-top:12px; display:flex; gap:8px;>
                <button type="submit" name="action" value="draft" class="btn" style="background:#9e9e9e;">임시저장</button>
                <button type="submit" name="action" value="publish" class="btn">등록</button>
            </div>
        </form>
    </div>
</div>

{# Quill CDN #}
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>

<script>
  // 폰트 화이트리스트 먼저 등록
  var Font = Quill.import('formats/font');
  Font.whitelist = ['sans', 'gowun', 'diphylleia'];
  Quill.register(Font, true);

  // 툴바 옵션 (색상 / 배경색 / 밑줄 / 취소선 / 폰트 / 크기 등)
  const toolbarOptions = [
    [{ 'font': Font.whitelist }],
    [{ 'size': ['small', false, 'large', 'huge'] }],
    ['bold', 'italic', 'underline', 'strike'],
    [{ 'color': [] }, { 'background': [] }],
    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
    [{ 'align': [] }],
    ['link'],
    ['clean']
  ];

  // Quill 생성
  var quill = new Quill('#editor', {
    theme: 'snow',
    placeholder: '공지 내용을 입력하세요...',
    modules: {
      toolbar: toolbarOptions
    }
  });

  // 폼 전송 시 HTML을 hidden input에 넣기
  document.getElementById('noticeForm').addEventListener('submit', function () {
    document.getElementById('content_html').value = quill.root.innerHTML;
  });
</script>
{% endblock %}
