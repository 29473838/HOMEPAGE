{% extends "base.html" %}
{% block title %}Q&A{% endblock %}

{% block content %}
<h1 class="page-title">Q&A</h1>

{# Q&A ì‘ì„± í¼ #}
<div class="card">
{% if current_user.is_authenticated %}
    <form method="post" enctype="multipart/form-data">
        <label>ì œëª©</label>
        <input type="text" name="title" required>

        <label>ë‚´ìš©</label>
        <textarea name="content" required></textarea>

        <label>ì²¨ë¶€íŒŒì¼ (ì´ë¯¸ì§€/ì˜ìƒ)</label>
        <input type="file" name="attachment" accept="image/*,video/*">

        <button type="submit" class="btn" style="margin-top:10px;">ë“±ë¡</button>
    </form>
{% else %}
    <p>Q&A ì‘ì„±ì€ <a href="{{ url_for('login') }}">ë¡œê·¸ì¸</a> í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
{% endif %}
</div>

{# HOT Q&A ì˜ì—­ (ìµœëŒ€ 10ê°œ) #}
{% if hot_qnas %}
<h2 class="page-title" style="margin-top:30px;">HOT Q&A</h2>

{% for p in hot_qnas %}
<div class="card" style="border:2px solid #ff9800;">
    <div style="font-weight:600;">
        ğŸ”¥ {{ p.title }}

        {# ê´€ë¦¬ìë§Œ HOT í•´ì œ ê°€ëŠ¥ #}
        {% if current_user.is_authenticated and current_user.role in ["ëŒ€í‘œ","ë¶€ëŒ€í‘œ","ë§¤ë‹ˆì €"] %}
        <form method="post"
              action="{{ url_for('qna_toggle_hot', id=p.id) }}"
              style="display:inline;">
            <button type="submit" class="btn" style="font-size:11px;padding:2px 6px;margin-left:6px;">
                HOT í•´ì œ
            </button>
        </form>
        {% endif %}
    </div>

    <div style="font-size:12px;color:#666;">
        {{ p.created_at.strftime("%Y-%m-%d %H:%M") }}
    </div>

    <p style="margin-top:8px;white-space:pre-line;">{{ p.content }}</p>

    {# ì²¨ë¶€íŒŒì¼ í‘œì‹œ #}
    {% if p.attachment %}
        {% if p.attachment_type == "image" %}
            <img src="{{ p.attachment }}" style="max-width:100%;margin-top:8px;">
        {% elif p.attachment_type == "video" %}
            <video controls style="max-width:100%;margin-top:8px;">
                <source src="{{ p.attachment }}">
                ë¸Œë¼ìš°ì €ê°€ ì˜ìƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </video>
        {% endif %}
    {% endif %}

    {# ê´€ë¦¬ì ë‹µë³€ ë‚´ìš© #}
    {% if p.answer %}
        <div style="margin-top:10px;padding:8px 10px;background:#f3f3f3;border-radius:6px;font-size:14px;">
            <strong>ê´€ë¦¬ì ë‹µë³€</strong><br>
            <span style="white-space:pre-line;">{{ p.answer }}</span>
        </div>
    {% endif %}

    {# ê´€ë¦¬ì ë‹µë³€ ì…ë ¥ í¼ #}
    {% if current_user.is_authenticated and current_user.role in ["ëŒ€í‘œ","ë¶€ëŒ€í‘œ","ë§¤ë‹ˆì €"] %}
        <form method="post"
              action="{{ url_for('qna_answer', id=p.id) }}"
              style="margin-top:10px;">
            <label>ë‹µë³€</label>
            <textarea name="answer" required>{{ p.answer or "" }}</textarea>
            <button type="submit" class="btn" style="margin-top:5px;">ë‹µë³€ ë“±ë¡/ìˆ˜ì •</button>
        </form>
    {% endif %}
</div>
{% endfor %}
{% endif %}

{# ì „ì²´ Q&A ë¦¬ìŠ¤íŠ¸ #}
<h2 class="page-title" style="margin-top:30px;">ì „ì²´ Q&A</h2>

{% for p in qnas %}
<div class="card">
    <div style="font-weight:600;">
        {{ p.title }}

        {# ê´€ë¦¬ìë§Œ HOT ì§€ì •/í•´ì œ ê°€ëŠ¥ #}
        {% if current_user.is_authenticated and current_user.role in ["ëŒ€í‘œ","ë¶€ëŒ€í‘œ","ë§¤ë‹ˆì €"] %}
        <form method="post"
              action="{{ url_for('qna_toggle_hot', id=p.id) }}"
              style="display:inline;">
            <button type="submit" class="btn" style="font-size:11px;padding:2px 6px;margin-left:6px;">
                {% if p.is_hot %}HOT í•´ì œ{% else %}HOT ì§€ì •{% endif %}
            </button>
        </form>
        {% endif %}
    </div>

    <div style="font-size:12px;color:#666;">
        {{ p.created_at.strftime("%Y-%m-%d %H:%M") }}
    </div>

    <p style="margin-top:8px;white-space:pre-line;">{{ p.content }}</p>

    {# ì²¨ë¶€íŒŒì¼ í‘œì‹œ #}
    {% if p.attachment %}
        {% if p.attachment_type == "image" %}
            <img src="{{ p.attachment }}" style="max-width:100%;margin-top:8px;">
        {% elif p.attachment_type == "video" %}
            <video controls style="max-width:100%;margin-top:8px;">
                <source src="{{ p.attachment }}">
                ë¸Œë¼ìš°ì €ê°€ ì˜ìƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </video>
        {% endif %}
    {% endif %}

    {# ê´€ë¦¬ì ë‹µë³€ ë‚´ìš© #}
    {% if p.answer %}
        <div style="margin-top:10px;padding:8px 10px;background:#f3f3f3;border-radius:6px;font-size:14px;">
            <strong>ê´€ë¦¬ì ë‹µë³€</strong><br>
            <span style="white-space:pre-line;">{{ p.answer }}</span>
        </div>
    {% endif %}

    {# ê´€ë¦¬ì ë‹µë³€ ì…ë ¥ í¼ #}
    {% if current_user.is_authenticated and current_user.role in ["ëŒ€í‘œ","ë¶€ëŒ€í‘œ","ë§¤ë‹ˆì €"] %}
        <form method="post"
              action="{{ url_for('qna_answer', id=p.id) }}"
              style="margin-top:10px;">
            <label>ë‹µë³€</label>
            <textarea name="answer" required>{{ p.answer or "" }}</textarea>
            <button type="submit" class="btn" style="margin-top:5px;">ë‹µë³€ ë“±ë¡/ìˆ˜ì •</button>
        </form>
    {% endif %}
</div>
{% else %}
<p>ë“±ë¡ëœ Q&Aê°€ ì—†ìŠµë‹ˆë‹¤.</p>
{% endfor %}

{% endblock %}
